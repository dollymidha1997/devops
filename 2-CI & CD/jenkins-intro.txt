


pipeline-script samples


--------------------------------------------------------------------------
# basic
--------------------------------------------------------------------------
node {
    echo 'Hello World'
}


--------------------------------------------------------------------------
# pipeline with stages
--------------------------------------------------------------------------
node {
   stage('stage 1'){
       echo 'Hello World'
   }
   stage('stage 2'){
       echo 'im in stage 2'
   }
}

--------------------------------------------------------------------------
# pipeline with stage & steps
--------------------------------------------------------------------------


node {
  
  stage('echo'){
      sh 'echo "Hello World"'
      sh '''
            echo "Multiline shell steps works too"
            ls -lah
        '''
  }
  
}


--------------------------------------------------------------------------
  checking type of Node 
--------------------------------------------------------------------------


node {
  
  stage('list directory'){
      if(isUnix()){
          sh "ls -la"
      }else{
          bat 'dir'
      }
  }
  
}



--------------------------------------------------------------------------
  Checkout code from SCM i.e git
--------------------------------------------------------------------------


node {
  
  stage('checkout'){
    git 'https://github.com/effectivejenkins/my-awesome-project.git'
  }
  stage('Say Hello'){
      sh './say_hello.sh'
  }
  
}


--------------------------------------------------------------------------
  Managing passwords in pipeline
--------------------------------------------------------------------------


node {
  stage('use passwords'){
    withCredentials([usernamePassword(credentialsId: 'my_id_1', passwordVariable: 'MY_PASSWORD', usernameVariable: 'MY_USERNAME')]) {
        echo "My Password is '${MY_PASSWORD}'!"
    }
  }
  
}

--------------------------------------------------------------------------
  Finishing up Build
--------------------------------------------------------------------------

node {
    try{
        stage("echo"){
            sh 'echo "Hello World"'
            def obj=null
            sh "${obj.class}"
        }
    }catch(NullPointerException e){
        error 'broken pipeline - null pointer exception'
        currentBuild.result='FAILURE'
        //currentBuild.result='UNSTABLE'
    } 
    finally{
        stage('post build'){
            echo 'this always run'
        }
    }
}

note : each stage can have own try-bock


--------------------------------------------------------------------------
  Email Notification
--------------------------------------------------------------------------

note : configure email Notification


node {
    try{
        stage("echo"){
            sh 'echo "Hello World"'
            def obj=null
            sh "${obj.class}"
        }
    }catch(NullPointerException e){
        error 'broken pipeline - null pointer exception'
        currentBuild.result='FAILURE'
        //currentBuild.result='UNSTABLE'
    } 
    finally{
        stage('post build'){
            mail bcc: '', body: "something is wrong  with ${env.BUILD_URL}", cc: '', from: '', replyTo: '', subject: "Failed Pipeline ${currentBuild.fullDisplayName}", to: 'someone@email.com'
        }
    }
}



--------------------------------------------------------------------------
  Declarative Pipeline
--------------------------------------------------------------------------

pipeline{
    agent {
        label 'linux'
    }
    tools{
        maven 'M3'
    }
    parameters{
        string(name:'VERSION',defaultValue:'1.0.0',description:'what is the version build?')
    }
    stages{
        stage("Build) {
            steps{
                sh 'echo "${params.VERSION}"'
            }
        }
    }
    post{
        always{

        }
    }
}


--------------------------------------------------------------------------
  Jenkins file
--------------------------------------------------------------------------

pipeline{
    agent any
    stages{
        stage('checkout){
            steps{
                git ''
            }
        }
        stage('Build'){
            steps{
                sh 'mvn clean compile'
            }
        }
        stage('Test'){
            steps{
                sh 'mvn test'
                junit '**/target/surefire-reports/Test-*.xml'
            }
        }
        stage{
            steps{
                sh 'mvn package'
            }
        }
    }
}